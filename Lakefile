// import "github.com/maxmcd/lake/lib" {}
// https://github.com/google/starlark-go/blob/master/starlark/example_test.go

store "busybox_tar" { 
  env = {
    fetch_url = "true"
    url = "http://lake.com/busybox.tar.gz" 
  }
  network = true
}


config {
  shell = ["${busybox_tar}/bin/busybox", "sh"]
}

store "busybox_store" {
  inputs = [
    busybox_tar, "./script.sh", 
    // lib.lake_tar_gz,
  ]
  env = {
    FOO = "bar"
  }
  script = <<EOH
    #!${busybox_tar}/bin/busybox sh
    sh ./script.sh
  EOH
}


build_script = "./script.sh"

store "busybox_store_alt" {
  inputs = [busybox_tar, build_script]
  shell  = ["${busybox_tar}/bin/busybox", "sh"]
  script = "sh ./script.sh"
}

target "busybox" {
  inputs = [busybox_store]
  script = <<EOH
    #!${busybox_store}/bin/busybox sh
    $busybox_store $@
  EOH
}

# Are tests a thing?
# test "ensure it runs" {
#
# }


# Do self references work? Doesn't this loop infinitely? How do wildcard matches
# work with various identifier names? Like what if I have another target called
# "./other.Lakefile"?
target "./*Lakefile" {
  inputs = ["./*Lakefile"]
  script = <<EOH
  nomad fmt .
  EOH
}
